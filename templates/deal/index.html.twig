{% extends 'base.html.twig' %}

{% block title %} {{ site.name }} {% endblock %}

{% block body %}
    <h1>Liste des Deals</h1>

    <table class="table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Description</th>
                <th>Price</th>
                <th>Date</th>
            </tr>
        </thead>
        <tbody>
        {# On utilise une variable pour savoir si on a affiché au moins un deal #}
        {% set hasVisibleDeal = false %}
        
        {% for deal in deals %}
            {% if is_granted('DEAL_VIEW', deal) %}
                {% set hasVisibleDeal = true %}
                <tr>
                    <td>{{ component('DealComponent', {id: deal.id}) }}</td>
                    
                    <td>{{ deal.name }}</td>
                    <td>{{ deal.description }}</td>
                    <td>{{ deal.price }} €</td>
                    <td>{{ deal.createAt ? deal.createAt|date('d/m/Y') : 'N/A' }}</td>
                    
                </tr>
            {% endif %}
        {% else %}
            <tr>
                <td colspan="6">Aucun deal n'existe en base de données.</td>
            </tr>
        {% endfor %}

        {# Message si des deals existent mais qu'aucun n'est accessible #}
        {% if deals is not empty and not hasVisibleDeal %}
            <tr>
                <td colspan="6" class="text-center text-muted">
                    <em>Vous n'avez pas les permissions pour voir les deals premium.</em>
                </td>
            </tr>
        {% endif %}
        </tbody>
    </table>

    <hr>
    <div class="alert alert-secondary">
        <h2>{{ slogan }}</h2>
        <h3>Your special discount is: <strong>{{ discount }}%</strong></h3>
    </div>
{% endblock %}